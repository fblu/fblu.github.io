<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Build a Progressive Web App | Electrode</title>
  <meta name="viewport" content="width=device-width">
  <meta property="og:title" content="Build a Progressive Web App | Electrode">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://electrode-io.github.io//docs/service_workers.html">
  <meta property="og:image" content="https://electrode-io.github.io/img/logo_og.png">
  <meta property="og:description" content="Universal React and Node Applications simplified, performant, and reusable.">
  <meta property="fb:app_id" content="623268441017527">


  <link rel="shortcut icon" href="/img/favicon-64.png">
  <link rel="alternate" type="application/rss+xml" title="Electrode" href="https://electrode-io.github.io/feed.xml">

  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/electrode-docs.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700" type="text/css">

  <script src="//use.typekit.net/vqa1hcx.js"></script>

  <!-- Add GA for all github pages -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84301828-1', 'auto');
  ga('send', 'pageview');
</script>


  <!--[if lte IE 8]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/es5-shim.min.js"></script>
  <script src="/js/es5-sham.min.js"></script>
  <![endif]-->

</head>
<body>

  <div class="container">
    <header class="header">
  <a href="/index.html">
    <img class="electrode-logo" src="/img/electrode-logo-sm@2x.png" />
  </a>
  <div class="header-right-side">
    <ul class="header-menu">
      <li class="header-menu-item home"><a href="/index.html">HOME</a></li>
      <li class="header-menu-item docs  selected "><a href="/docs/what_is_electrode.html">DOCS</a></li>
      <li class="header-menu-item contribute "><a href="/docs/contribute.html">CONTRIBUTE</a></li>
    </ul>
    <ul class="header-social">
      <li class="header-social-pocket"><a href="https://getpocket.com/"><img src="/img/pocket_@1x.png" /></a></li>
      <li class="header-social-twitter"><a href="https://twitter.com/electrode_io"><img src="/img/twitter_@1x.png" /></a></li>
      <li class="header-social-github"><a href="https://github.com/electrode-io"><img src="/img/github_@1x.png" /></a></li>
    </ul>
  </div>
</header>


    

    <section class="content wrap documentationContent">
  <div class="nav-docs">
  
    <div class="nav-docs-section">
      <h3>Overview</h3>
      
        <ul>
          


  
  
  
  
    <li>
    

    <a href="/docs/what_is_electrode.html"> &nbsp; What is Electrode?</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/why_use_electrode.html"> &nbsp; Why Use Electrode?</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/requirements.html"> &nbsp; Requirements</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


        </ul>
      
    </div>
  
    <div class="nav-docs-section">
      <h3>Getting Started</h3>
      
        
          <h5>Quick Start</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/get_started.html"> &nbsp; Get Started</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/build_component.html"> &nbsp; Build Component</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/deploy_app.html"> &nbsp; Deploy Your App</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/whats_inside.html"> &nbsp; What's Inside</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/what_are_archetypes.html"> &nbsp; What are Archetypes?</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
          <h5>Intermediate</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/create_reusable_component.html"> &nbsp; Create a Reusable Component</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/low_level_components.html"> &nbsp; Low-Level Components</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/component_helpers.html"> &nbsp; Component Helpers</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/develop_styles.html"> &nbsp; Develop Styles</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/high_level_component.html"> &nbsp; Develop Main Component</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/test_components.html"> &nbsp; Test Components</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/add_examples.html"> &nbsp; Add Examples</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/build_and_demo.html"> &nbsp; Build and Demo</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/generate_docs.html"> &nbsp; Generate Docs</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/build_server_plugin.html"> &nbsp; Build a Server Plugin</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/add_routes.html"> &nbsp; Add Routes</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/server_config.html"> &nbsp; Server Config</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/more_deployments.html"> &nbsp; More Deployments</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/docker.html"> &nbsp; Docker</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/kubernetes.html"> &nbsp; Kubernetes</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/build_with_material_ui.html"> &nbsp; Build with material-ui</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/service_workers.html" class="active"> &nbsp; Build a Progressive Web App</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/ss_data_hydration.html"> &nbsp; Server Side Data Hydration</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
          <h5>Advanced</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/stand_alone_modules.html"> &nbsp; Stand Alone Modules</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/confippet.html"> &nbsp; Confippet</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/above_fold_rendering.html"> &nbsp; Above The Fold Rendering</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/server_side_render_cache.html"> &nbsp; Server Side Render Caching + Profiling</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/stateless_csrf_validation.html"> &nbsp; Stateless CSRF Validation</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/redux_router_engine.html"> &nbsp; Redux Router Engine</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/electrode_tools.html"> &nbsp; Powerful Electrode Tools</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/electrify.html"> &nbsp; Electrify</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/electrode_explorer.html"> &nbsp; Electrode Explorer</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/bundle_analyzer.html"> &nbsp; Bundle Analyzer</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/electrode_boilerplate.html"> &nbsp; Electrode Boilerplate</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
          <h5>Over the Air</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/electrode_react_native_over_the_air_electron.html"> &nbsp; React Native and Over the Air</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
      
    </div>
  
    <div class="nav-docs-section">
      <h3>Contributing</h3>
      
        <ul>
          


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/contribute.html"> &nbsp; Contribute</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/community.html"> &nbsp; Community</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  


        </ul>
      
    </div>
  
    <div class="nav-docs-section">
      <h3>Resources</h3>
      
        <ul>
          


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/further_reading.html"> &nbsp; Further Reading</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/glossary.html"> &nbsp; Glossary</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/faq.html"> &nbsp; FAQs</a>

    
    </li>
  


        </ul>
      
    </div>
  


  <!-- Tips Nav -->
  <!-- 
    <div class="nav-docs-section">
      <h3>Tips</h3>
      <ul>
        
          <li>
            <a href="/tips/introduction.html">Introduction</a>
          </li>
        
      </ul>
    </div>
   -->

  <!-- Contributing Nav -->
  <!-- 
    <div class="nav-docs-section">
      <h3>Contributing</h3>
      <ul>
        
          <li>
            <a href="/contributing/design-principles.html">Design Principles</a>
          </li>
        
      </ul>
    </div>
   -->
</div>


  <div class="inner-content">
    <a class="edit-page-link" href="https://github.com/electrode-io/electrode-io.github.io/tree/master/_docs/03.7-progressive_web_app.markdown" target="_blank">Edit on GitHub</a>
    <h1>Build a Progressive Web App</h1>
    <div class="subHeader"></div>

    <p>“A Progressive Web App (PWA) uses modern web capabilities to deliver an app-like
user experience.” – <a href="https://developers.google.com/web/progressive-web-apps/">Progressive Web Apps</a></p>

<p>PWAs are incredibly powerful and provide functionalities like offline first,
push notifications, background sync, GPU rendering, 60FPS scrolling and add
to home screen for a native-like app experience.</p>

<p>PWAs are based on <a href="https://developers.google.com/web/fundamentals/getting-started/primers/service-workers">Service Workers</a>, which work independently in the background
without interfering with your web app’s life cycle.</p>

<h2 id="benefits-of-using-electrode-pwa">Benefits of using Electrode PWA</h2>

<h3 id="low-friction-of-distribution">Low friction of distribution</h3>

<p>If your progressive web app is online, it’s already accessible for Chrome on
Android (and other mobile). Your customers won’t have to download an “app” from
the App Store. 65.5% of US smartphone users don’t download any new apps each
month. PWAs eliminate the need to go to the app store, search for the app, click
Install, wait for the download, then open the app. Each of these steps loses 20%
of potential users.</p>

<p>From a developer’s point of view, you don’t need to rely on the Play Store to
publish your app! Push new changes to your web app, and the service worker will
take care of updating the app shell.</p>

<h3 id="frictionless-shopping-experience">Frictionless shopping experience</h3>

<p>For example: for an e-commerce business, PWA offers our customers a more
frictionless shopping experience that allows shoppers to search, buy, and
checkout quickly without downloading the native app. Furthermore, it allows you
to bring app-like experiences to mobile websites, including personalization and
targeted offers.</p>

<h3 id="faster-mobile-experience">Faster mobile experience</h3>

<p>Web Apps built with Electrode + PWA will be significantly faster. Also, these
websites enable an offline mode, allowing customers to continue browsing in
areas with poor wireless reception (for example, on public transit). Given the
fact that faster websites have higher conversion rates, websites built with PWA
could result in increased revenue.</p>

<h3 id="personalized-push-notifications">Personalized push notifications</h3>

<p>Electrode Push notifications can be used to interact effectively with mobile
customers, as these notifications are native to the mobile device and can be
personal and timely. Similar notifications can be sent to desktop websites too.</p>

<h2 id="getting-started">Getting Started</h2>

<p>In the first section, we are going to make your previously built Electrode app
into a PWA with content caching, push notifications, and an option for the user
to save your web app to their home screen.</p>

<p><em>If you are starting out with a new PWA, just answer “Y” to the following
question</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yo electrode
<span class="c"># ... answer questions ...</span>
<span class="c"># Would you like to make a Progressive Web App? (Y/n)</span>
<span class="c"># ... answer rest of the questions and wait for app to be generated ...</span>
</code></pre></div></div>

<p><em>Follow Prerequisites and skip to <a href="service_workers.html#push-notifications">Push Notifications</a></em></p>

<h3 id="prerequisites">Prerequisites</h3>

<ol>
  <li>We need certain API keys for push notifications. To generate these values,
visit <a href="https://console.firebase.google.com">Firebase</a> and create a new project. Click on the settings icon and
open <code class="language-plaintext highlighter-rouge">Project settings</code>. Navigate to the <code class="language-plaintext highlighter-rouge">CLOUD MESSAGING</code> tab and note down
your <code class="language-plaintext highlighter-rouge">Server key</code> and the <code class="language-plaintext highlighter-rouge">Sender ID</code>.</li>
  <li>In the <code class="language-plaintext highlighter-rouge">client/images</code> directory, add the <a href="https://github.com/electrode-io/electrode/blob/d4142ee0c938cbf973a429ee8467052aa4e1c9be/samples/universal-react-node/client/images/logo-192x192.png">logo 192x192</a> and <a href="https://github.com/electrode-io/electrode/blob/d4142ee0c938cbf973a429ee8467052aa4e1c9be/samples/universal-react-node/client/images/logo-72x72.png">logo 72x72</a>
icon images. We’ll use these logos for the <code class="language-plaintext highlighter-rouge">Add to Homescreen</code> banner and
push notifications.</li>
</ol>

<h3 id="generating-a-service-worker">Generating a Service Worker</h3>

<p>Generating a service worker in an electrode app is as simple as adding a config
file. Navigate to <code class="language-plaintext highlighter-rouge">&lt;your-awesome-app&gt;/config</code> and create a new <code class="language-plaintext highlighter-rouge">sw-config.js</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">cache</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">cacheId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">&lt;your-awesome-app&gt;</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">runtimeCaching</span><span class="p">:</span> <span class="p">[{</span>
      <span class="na">handler</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fastest</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">urlPattern</span><span class="p">:</span> <span class="sr">/</span><span class="se">\/</span><span class="sr">$/</span>
    <span class="p">}],</span>
    <span class="na">staticFileGlobs</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">dist/**/*</span><span class="dl">'</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="na">manifest</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">&lt;your-awesome-app&gt;</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">logo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./images/logo-192x192.png</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">short_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">EPA</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">background</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#FFFFFF</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">theme_color</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#FFFFFF</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This will generate a <code class="language-plaintext highlighter-rouge">sw.js</code> in the <code class="language-plaintext highlighter-rouge">dist</code> folder when you build the app.</p>

<h3 id="registering-the-service-worker">Registering the Service Worker</h3>

<p>We need to create a server plugin to access <code class="language-plaintext highlighter-rouge">dist/sw.js</code>. Create a file called
<code class="language-plaintext highlighter-rouge">server/plugins/pwa/index.js</code>, and add the following code:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">use strict</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/sw.js</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">handler</span><span class="p">:</span> <span class="p">{</span> <span class="na">file</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dist/sw.js</span><span class="dl">"</span> <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">register</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pwa</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.0.1</span><span class="dl">"</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Also, add the following to <code class="language-plaintext highlighter-rouge">plugins</code> inside <code class="language-plaintext highlighter-rouge">config/default.json</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">pwa</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">module</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./server/plugins/pwa</span><span class="dl">"</span> <span class="p">}</span>
</code></pre></div></div>

<p>To register the service worker on the browser, create a file called
<code class="language-plaintext highlighter-rouge">sw-registration.js</code> inside the <code class="language-plaintext highlighter-rouge">client</code> directory and add the following code:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Exit early if the navigator isn't available</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">navigator</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Feature check if service workers are supported.</span>
  <span class="k">if</span> <span class="p">(</span><span class="dl">"</span><span class="s2">serviceWorker</span><span class="dl">"</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="dl">"</span><span class="s2">sw.js</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">scope</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./</span><span class="dl">"</span> <span class="p">})</span>
      <span class="c1">// Service worker registration was successful</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">registration</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// The updatefound event is dispatched when the installing</span>
        <span class="c1">// worker changes. This new worker will potentially become</span>
        <span class="c1">// the active worker if the install process completes.</span>
        <span class="nx">registration</span><span class="p">.</span><span class="nx">onupdatefound</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">installingWorker</span> <span class="o">=</span> <span class="nx">registration</span><span class="p">.</span><span class="nx">installing</span><span class="p">;</span>
          <span class="c1">// Listen for state changes on the installing worker so</span>
          <span class="c1">// we know when it has completed.</span>
          <span class="nx">installingWorker</span><span class="p">.</span><span class="nx">onstatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">installingWorker</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="dl">"</span><span class="s2">installing</span><span class="dl">"</span><span class="p">:</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Installing a new service worker...</span><span class="dl">"</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="dl">"</span><span class="s2">installed</span><span class="dl">"</span><span class="p">:</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">controller</span><span class="p">);</span>
              <span class="c1">// We check the active controller which tells us if</span>
              <span class="c1">// new content is available, or the current service worker</span>
              <span class="c1">// is up to date (?)</span>
              <span class="c1">// TODO: Figure out why this is the case</span>
              <span class="k">if</span> <span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">New or updated content is available, refresh!</span><span class="dl">"</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content is now available offline!</span><span class="dl">"</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="dl">"</span><span class="s2">activating</span><span class="dl">"</span><span class="p">:</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Activating a service worker...</span><span class="dl">"</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="dl">"</span><span class="s2">activated</span><span class="dl">"</span><span class="p">:</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Successfully activated service worker.</span><span class="dl">"</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="dl">"</span><span class="s2">redundant</span><span class="dl">"</span><span class="p">:</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Service worker has become redundant</span><span class="dl">"</span><span class="p">);</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">};</span>
        <span class="p">};</span>
      <span class="p">})</span>
      <span class="c1">// Service worker registration failed</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Service worker registration failed: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Import it in <code class="language-plaintext highlighter-rouge">client/app.jsx</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">require</span><span class="p">.</span><span class="nx">ensure</span><span class="p">([</span><span class="dl">"</span><span class="s2">./sw-registration</span><span class="dl">"</span><span class="p">],</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./sw-registration</span><span class="dl">"</span><span class="p">)();</span>
<span class="p">},</span> <span class="dl">"</span><span class="s2">sw-registration</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<p>We achieved a couple of things here:</p>

<ol>
  <li>
    <p>“Offline First” with the cache property.</p>

    <p>Precache your static assets generated by webpack using the staticFileGlobs
property. Or, use the runtimeCaching property to cache specific react routes
in <code class="language-plaintext highlighter-rouge">routes.jsx</code>.</p>
  </li>
  <li>
    <p>“Add to Home” with the manifest property.</p>

    <p>After visiting your website, users will get a prompt (if the user has
visited your site at least twice, with at least five minutes between
visits) to add your application to their homescreen. <code class="language-plaintext highlighter-rouge">manifest</code> gives you
control over how your web app is installed on user’s home screen with
<code class="language-plaintext highlighter-rouge">short_name</code>, <code class="language-plaintext highlighter-rouge">title</code> and <code class="language-plaintext highlighter-rouge">logo</code> properties.</p>
  </li>
</ol>

<p>Build your app and start the server with</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gulp pwa
</code></pre></div></div>

<p><strong>Note: Service worker currently does not work with webpack-dev-server. You
need to build first and then run the server.</strong></p>

<p>Navigate to <code class="language-plaintext highlighter-rouge">http://localhost:3000</code>, open <code class="language-plaintext highlighter-rouge">Developer tools</code>, and click on the
<code class="language-plaintext highlighter-rouge">Application</code> tab. You should see your <code class="language-plaintext highlighter-rouge">Service Worker</code> activated and running!</p>

<p><img src="https://cloud.githubusercontent.com/assets/4782871/20909807/b322e462-bb12-11e6-97af-797c808e11d9.png" alt="screenshot" /></p>

<p>Go ahead and click on the <code class="language-plaintext highlighter-rouge">Offline</code> checkbox in the Developer tools. Terminate
your server. Refresh your web page.</p>

<p><strong>NOTE: The <code class="language-plaintext highlighter-rouge">Add to Homescreen</code> banner will pop up only on Android devices with
Chrome 42+. To simulate the banner on your desktop Chrome, navigate to
<code class="language-plaintext highlighter-rouge">Developer tools</code> -&gt; <code class="language-plaintext highlighter-rouge">Applications</code> -&gt; <code class="language-plaintext highlighter-rouge">Manifest</code> and click on <code class="language-plaintext highlighter-rouge">Add to
homescreen</code>.</strong></p>

<h3 id="push-notifications">Push notifications</h3>

<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Push_API">Push API</a> requires a registered service worker so it can send notifications
in the background when the web application isn’t running. We already have our
Service Worker generated with the help of <code class="language-plaintext highlighter-rouge">sw-config.js</code>. We only need to add a
<code class="language-plaintext highlighter-rouge">Push</code> event to it. Create a new file <code class="language-plaintext highlighter-rouge">sw-events.js</code> inside the <code class="language-plaintext highlighter-rouge">client</code>
directory and add the following to it:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* eslint-env serviceworker */</span>

<span class="k">import</span> <span class="nx">icon</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./images/logo-192x192.png</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">badge</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./images/logo-72x72.png</span><span class="dl">"</span><span class="p">;</span>

<span class="nb">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">push</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">It worked!</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Great job sending that push notification!</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">electrode-push-notification-test</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">icon</span><span class="p">,</span>
    <span class="nx">badge</span>
  <span class="p">};</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
    <span class="nb">self</span><span class="p">.</span><span class="nx">registration</span><span class="p">.</span><span class="nx">showNotification</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Check out the <a href="https://developers.google.com/web/fundamentals/getting-started/codelabs/push-notifications/">Adding Push Notifications to a Web App</a> Codelab provided by
Google for an in-depth guide on how push notifications and service workers work
together.</p>

<p>Now we need to add this file to our Webpack bundle by referencing it in the
<code class="language-plaintext highlighter-rouge">cache property</code> of <code class="language-plaintext highlighter-rouge">sw-config.js</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">cache</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">importScripts</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./sw-events.js</span><span class="dl">'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we have a registered service worker installed, activated and ready to accept
<code class="language-plaintext highlighter-rouge">push</code> from the server. But before we can <code class="language-plaintext highlighter-rouge">push</code> we need to <code class="language-plaintext highlighter-rouge">request
permissions</code> from the user and <code class="language-plaintext highlighter-rouge">subscribe</code> them to the notifications.</p>

<p>Navigate to <code class="language-plaintext highlighter-rouge">client/components/home.jsx</code> and replace it with:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* eslint-disable react/no-did-mount-set-state */</span>
<span class="cm">/* global navigator */</span>

<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">PropTypes</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">connect</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-redux</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">toggleCheck</span><span class="p">,</span> <span class="nx">incNumber</span><span class="p">,</span> <span class="nx">decNumber</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../actions</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">Home</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">super</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">// Whether ServiceWorkers are supported</span>
        <span class="na">supported</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="c1">// Did something fail?</span>
        <span class="na">error</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="c1">// Waiting on the service worker to be ready</span>
        <span class="na">loading</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="c1">// Whether we"ve got a push notification subscription</span>
        <span class="na">subscribed</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="c1">// The actual subscription itself</span>
        <span class="na">subscription</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="na">title</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span> <span class="dl">""</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sendNotification</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sendNotification</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleInputChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleInputChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">subscribe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="dl">"</span><span class="s2">serviceWorker</span><span class="dl">"</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">registration</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="c1">// Check for any existing subscriptions</span>
          <span class="nx">registration</span><span class="p">.</span><span class="nx">pushManager</span><span class="p">.</span><span class="nx">getSubscription</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">subscription</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// No current subscription, let the user subscribe</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">subscription</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">subscribed</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">supported</span><span class="p">:</span> <span class="kc">true</span>
              <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="nx">subscription</span><span class="p">,</span>
                <span class="na">subscribed</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">supported</span><span class="p">:</span> <span class="kc">true</span>
              <span class="p">});</span>
            <span class="p">}</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">error</span><span class="p">});</span>
          <span class="p">});</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">error</span><span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// ServiceWorkers are not supported, let the user know.</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">supported</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">subscribe</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">registration</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">registration</span><span class="p">.</span><span class="nx">pushManager</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span> <span class="na">userVisibleOnly</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">subscription</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">subscription</span><span class="p">,</span> <span class="na">subscribed</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">error</span><span class="p">});</span>
          <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">handleInputChange</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
        <span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">]:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">sendNotification</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">{</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
      <span class="c1">// you can add badge, icon images in the options.</span>
      <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">body</span><span class="p">};</span>
      <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">registration</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">registration</span><span class="p">.</span><span class="nx">showNotification</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">checked</span><span class="p">,</span> <span class="nx">value</span><span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">;</span>
    <span class="kd">const</span> <span class="p">{</span>
      <span class="nx">error</span><span class="p">,</span>
      <span class="nx">loading</span><span class="p">,</span>
      <span class="nx">supported</span><span class="p">,</span>
      <span class="nx">subscribed</span><span class="p">,</span>
      <span class="nx">subscription</span>
    <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loading</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">supported</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Sorry</span><span class="p">,</span> <span class="nx">service</span> <span class="nx">workers</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">supported</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">browser</span><span class="p">.</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Woops</span><span class="o">!</span> <span class="nx">Looks</span> <span class="nx">like</span> <span class="nx">there</span> <span class="nx">was</span> <span class="nx">an</span> <span class="nx">error</span><span class="p">:</span>
          <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=&gt;</span>
            <span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span><span class="p">}:</span> <span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Checking</span> <span class="nx">push</span> <span class="nx">notification</span> <span class="nx">subscription</span> <span class="nx">status</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="se">)</span><span class="err">;
</span>    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">subscribed</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Click</span> <span class="nx">below</span> <span class="nx">to</span> <span class="nx">subscribe</span> <span class="nx">to</span> <span class="nx">push</span> <span class="nx">notifications</span>
          <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Subscribe</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">API_KEY</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">AIzaSyDAL_a1Hswn8QRRICDlh5PIIbEbFN7Aih0</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">GCM_ENDPOINT</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://android.googleapis.com/gcm/send</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">endpointSections</span> <span class="o">=</span> <span class="nx">subscription</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">subscriptionId</span> <span class="o">=</span> <span class="nx">endpointSections</span><span class="p">[</span><span class="nx">endpointSections</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="kd">const</span> <span class="nx">curlCommand</span> <span class="o">=</span> <span class="s2">`curl --header "Authorization: key=</span><span class="p">${</span><span class="nx">API_KEY</span><span class="p">}</span><span class="s2">"
    --header Content-Type:"application/json" </span><span class="p">${</span><span class="nx">GCM_ENDPOINT</span><span class="p">}</span><span class="s2"> -d
    "{\\"registration_ids\\":[\\"</span><span class="p">${</span><span class="nx">subscriptionId</span><span class="p">}</span><span class="s2">\\"]}"`</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">https://github.com/electrode-io</span><span class="dl">"</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="dl">"</span><span class="s2">Electrode</span><span class="dl">"</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/a&gt;&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Managing</span> <span class="nx">States</span> <span class="kd">with</span> <span class="nx">Redux</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">label</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">onChangeCheck</span><span class="p">}</span> <span class="nx">type</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">checkbox</span><span class="dl">"</span><span class="p">}</span> <span class="nx">checked</span><span class="o">=</span><span class="p">{</span><span class="nx">checked</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>            <span class="nx">Checkbox</span>
          <span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">onDecrease</span><span class="p">}</span><span class="o">&gt;-&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>            <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;{</span><span class="nx">value</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>
            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">onIncrease</span><span class="p">}</span><span class="o">&gt;+&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Push</span> <span class="nx">Notifications</span> <span class="kd">with</span> <span class="nx">Service</span> <span class="nx">Workers</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;
</span>        <span class="nx">Fill</span> <span class="nx">the</span> <span class="nx">form</span> <span class="nx">below</span> <span class="nx">and</span> <span class="nx">click</span> <span class="nx">on</span> <span class="nx">send</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">push</span> <span class="nx">notification</span><span class="p">.</span>
        <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Title</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleInputChange</span><span class="p">}</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Body</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleInputChange</span><span class="p">}</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">sendNotification</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Send</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Subscription</span> <span class="nx">Endpoint</span><span class="o">&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">subscription</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/code</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Curl</span> <span class="nx">Command</span><span class="o">&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">curlCommand</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/code</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Home</span><span class="p">.</span><span class="nx">propTypes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">checked</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">bool</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">isRequired</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">checked</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">checkBox</span><span class="p">.</span><span class="nx">checked</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">value</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">onChangeCheck</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">toggleCheck</span><span class="p">());</span>
    <span class="p">},</span>
    <span class="na">onIncrease</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">incNumber</span><span class="p">());</span>
    <span class="p">},</span>
    <span class="na">onDecrease</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">decNumber</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span> <span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">Home</span><span class="p">);</span>
</code></pre></div></div>

<p>Make sure you update the <code class="language-plaintext highlighter-rouge">API_KEY</code> with the one you previously generated in
<a href="#prerequisites">Prerequisites</a>.</p>

<p><code class="language-plaintext highlighter-rouge">navigator.serviceWorker.ready</code> is a promise that will resolve once a service
worker is registered, and it returns a reference to the active
<a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration">ServiceWorkerRegistration</a>. The showNotification() method of the
ServiceWorkerRegistration interface creates a notification and returns a Promise
that resolves to a <a href="https://developer.mozilla.org/en-US/docs/Web/API/NotificationEvent">NotificationEvent</a>.</p>

<p>We also need to update <code class="language-plaintext highlighter-rouge">sw-config.js</code> with the <code class="language-plaintext highlighter-rouge">sender_id</code>, so the final
<code class="language-plaintext highlighter-rouge">sw-config.js</code> should look like:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">cache</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">cacheId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">electrode</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">runtimeCaching</span><span class="p">:</span> <span class="p">[{</span>
      <span class="na">handler</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fastest</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">urlPattern</span><span class="p">:</span> <span class="dl">"</span><span class="se">\</span><span class="s2">/$</span><span class="dl">"</span>
    <span class="p">}],</span>
    <span class="na">staticFileGlobs</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">dist/**/*</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">importScripts</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./sw-events.js</span><span class="dl">'</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="na">manifest</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Electrode Progressive App</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">short_name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">EPA</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">background</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#FFFFFF</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">theme_color</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#FFFFFF</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">gcm_sender_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">YOUR SENDER ID</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Rebuild your app and run the server with</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gulp pwa
</code></pre></div></div>

<p>With all the code in place, we are ready to see push notifications in action.</p>

<p>Navigate to <code class="language-plaintext highlighter-rouge">http://localhost:3000</code>. Accept the permission for subscribing and
you will see a curl command rendered on the page. You can either run the curl
command from terminal to see the push notification or fill out the form and
click on the <code class="language-plaintext highlighter-rouge">Send</code> button to trigger it!</p>

<p>For more Electrode PWA code examples checkout <a href="https://github.com/electrode-samples/electrode-pwa-examples/tree/master/examples">electrode-pwa-examples</a> repo.</p>



    








<div class="docs-prevnext">
  
    <a class="docs-prev" href="/docs/build_with_material_ui.html">&larr; Prev</a>
  
  
    <a class="docs-next" href="/docs/ss_data_hydration.html">Next &rarr;</a>
  
</div>


  </div>
</section>


    <footer class="wrap">
      <div class="left">
        <a href="https://github.com/orgs/electrode-io/people" target="_blank">Acknowledgements</a>
      </div>
      <div class="right">
        &copy; 2020 <a href="http://walmartlabs.com" target="_blank">WalmartLabs</a><br>
        Apache-2.0 license.
      </div>
    </footer>
  </div>
  <div id="fb-root"></div>

  <!--
    TODO: analytics js, etc.
  -->
</body>
</html>
