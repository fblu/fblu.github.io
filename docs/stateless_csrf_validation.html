<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Stateless CSRF Validation | Electrode</title>
  <meta name="viewport" content="width=device-width">
  <meta property="og:title" content="Stateless CSRF Validation | Electrode">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://electrode-io.github.io//docs/stateless_csrf_validation.html">
  <meta property="og:image" content="https://electrode-io.github.io/img/logo_og.png">
  <meta property="og:description" content="Universal React and Node Applications simplified, performant, and reusable.">
  <meta property="fb:app_id" content="623268441017527">


  <link rel="shortcut icon" href="/img/favicon-64.png">
  <link rel="alternate" type="application/rss+xml" title="Electrode" href="https://electrode-io.github.io/feed.xml">

  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/electrode-docs.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700" type="text/css">

  <script src="//use.typekit.net/vqa1hcx.js"></script>

  <!-- Add GA for all github pages -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84301828-1', 'auto');
  ga('send', 'pageview');
</script>


  <!--[if lte IE 8]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/es5-shim.min.js"></script>
  <script src="/js/es5-sham.min.js"></script>
  <![endif]-->

</head>
<body>

  <div class="container">
    <header class="header">
  <a href="/index.html">
    <img class="electrode-logo" src="/img/electrode-logo-sm@2x.png" />
  </a>
  <div class="header-right-side">
    <ul class="header-menu">
      <li class="header-menu-item home"><a href="/index.html">HOME</a></li>
      <li class="header-menu-item docs  selected "><a href="/docs/what_is_electrode.html">DOCS</a></li>
      <li class="header-menu-item contribute "><a href="/docs/contribute.html">CONTRIBUTE</a></li>
    </ul>
    <ul class="header-social">
      <li class="header-social-pocket"><a href="https://getpocket.com/"><img src="/img/pocket_@1x.png" /></a></li>
      <li class="header-social-twitter"><a href="https://twitter.com/electrode_io"><img src="/img/twitter_@1x.png" /></a></li>
      <li class="header-social-github"><a href="https://github.com/electrode-io"><img src="/img/github_@1x.png" /></a></li>
    </ul>
  </div>
</header>


    

    <section class="content wrap documentationContent">
  <div class="nav-docs">
  
    <div class="nav-docs-section">
      <h3>Overview</h3>
      
        <ul>
          


  
  
  
  
    <li>
    

    <a href="/docs/what_is_electrode.html"> &nbsp; What is Electrode?</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/why_use_electrode.html"> &nbsp; Why Use Electrode?</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/requirements.html"> &nbsp; Requirements</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


        </ul>
      
    </div>
  
    <div class="nav-docs-section">
      <h3>Getting Started</h3>
      
        
          <h5>Quick Start</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/get_started.html"> &nbsp; Get Started</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/build_component.html"> &nbsp; Build Component</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/deploy_app.html"> &nbsp; Deploy Your App</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/whats_inside.html"> &nbsp; What's Inside</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/what_are_archetypes.html"> &nbsp; What are Archetypes?</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
          <h5>Intermediate</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/create_reusable_component.html"> &nbsp; Create a Reusable Component</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/low_level_components.html"> &nbsp; Low-Level Components</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/component_helpers.html"> &nbsp; Component Helpers</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/develop_styles.html"> &nbsp; Develop Styles</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/high_level_component.html"> &nbsp; Develop Main Component</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/test_components.html"> &nbsp; Test Components</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/add_examples.html"> &nbsp; Add Examples</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/build_and_demo.html"> &nbsp; Build and Demo</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/generate_docs.html"> &nbsp; Generate Docs</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/build_server_plugin.html"> &nbsp; Build a Server Plugin</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/add_routes.html"> &nbsp; Add Routes</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/server_config.html"> &nbsp; Server Config</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/more_deployments.html"> &nbsp; More Deployments</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/docker.html"> &nbsp; Docker</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/kubernetes.html"> &nbsp; Kubernetes</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/build_with_material_ui.html"> &nbsp; Build with material-ui</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/service_workers.html"> &nbsp; Build a Progressive Web App</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/ss_data_hydration.html"> &nbsp; Server Side Data Hydration</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
          <h5>Advanced</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/stand_alone_modules.html"> &nbsp; Stand Alone Modules</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/confippet.html"> &nbsp; Confippet</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/above_fold_rendering.html"> &nbsp; Above The Fold Rendering</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/server_side_render_cache.html"> &nbsp; Server Side Render Caching + Profiling</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/stateless_csrf_validation.html" class="active"> &nbsp; Stateless CSRF Validation</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/redux_router_engine.html"> &nbsp; Redux Router Engine</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/electrode_tools.html"> &nbsp; Powerful Electrode Tools</a>

    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/electrify.html"> &nbsp; Electrify</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/electrode_explorer.html"> &nbsp; Electrode Explorer</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    
      <ul><li>
    

    <a href="/docs/bundle_analyzer.html"> &nbsp; Bundle Analyzer</a>

    
      </li></ul>
    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/electrode_boilerplate.html"> &nbsp; Electrode Boilerplate</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
          <h5>Over the Air</h5>
          <ul>
            


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/electrode_react_native_over_the_air_electron.html"> &nbsp; React Native and Over the Air</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  


          </ul>
        
      
    </div>
  
    <div class="nav-docs-section">
      <h3>Contributing</h3>
      
        <ul>
          


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/contribute.html"> &nbsp; Contribute</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/community.html"> &nbsp; Community</a>

    
    </li>
  

  
  
  
  

  
  
  
  

  
  
  
  


        </ul>
      
    </div>
  
    <div class="nav-docs-section">
      <h3>Resources</h3>
      
        <ul>
          


  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li>
    

    <a href="/docs/further_reading.html"> &nbsp; Further Reading</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/glossary.html"> &nbsp; Glossary</a>

    
    </li>
  

  
  
  
  
    <li>
    

    <a href="/docs/faq.html"> &nbsp; FAQs</a>

    
    </li>
  


        </ul>
      
    </div>
  


  <!-- Tips Nav -->
  <!-- 
    <div class="nav-docs-section">
      <h3>Tips</h3>
      <ul>
        
          <li>
            <a href="/tips/introduction.html">Introduction</a>
          </li>
        
      </ul>
    </div>
   -->

  <!-- Contributing Nav -->
  <!-- 
    <div class="nav-docs-section">
      <h3>Contributing</h3>
      <ul>
        
          <li>
            <a href="/contributing/design-principles.html">Design Principles</a>
          </li>
        
      </ul>
    </div>
   -->
</div>


  <div class="inner-content">
    <a class="edit-page-link" href="https://github.com/electrode-io/electrode-io.github.io/tree/master/_docs/04.1.5-stateless_csrf_validation.markdown" target="_blank">Edit on GitHub</a>
    <h1>Stateless CSRF Validation</h1>
    <div class="subHeader"></div>

    <p>The <a href="https://github.com/electrode-io/electrode-csrf-jwt">electrode-csrf-jwt</a> plugin enables stateless CSRF protection using <a href="https://github.com/auth0/node-jsonwebtoken">JWT</a> in Electrode, Express, or Hapi applications.</p>
<h3><a class="anchor" name="why-do-we-need-this-module"></a>Why do we need this module? <a class="hash-link" href="#why-do-we-need-this-module">#</a></h3>
<p>Protection against <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)">CSRF</a> is a very important security feature. Traditional anti-CSRF techniques use tokens issued by the server that the client has to post back. The server validates the request by comparing the token with its own, stored copy. But what if your application does not rely on server-side session persistence? Protecting users against CSRF attacks when your application does not use back-end sessions can be tricky. The Stateless CSRF JWT Validation module addresses this need.</p>

<p>This module is a stand-alone module and can be configured to work in any <a href="#electrode">Electrode</a>, <a href="#express">Express</a>, or <a href="#hapi">Hapi</a> application.</p>
<h4><a class="anchor" name="how-do-we-validate-requests"></a>How do we validate requests? <a class="hash-link" href="#how-do-we-validate-requests">#</a></h4>
<p><strong><em>Double JWT CSRF tokens</em></strong></p>

<p>This Stateless CSRF Validation module is able to validate the authenticity of the client&#39;s request by relying on the fact that cross-site requests cannot set headers. Using two JWT CSRF tokens takes advantage of this.</p>

<p>Both tokens are generated on the server side with the same payload but different types: one for the HTTP header, one for the cookie. Note that when a client makes a request, the JWT token must be sent in the headers.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">headerPayload</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="nx">UUID</span><span class="o">:</span> <span class="s2">&quot;12345&quot;</span> <span class="p">};</span>
<span class="nx">cookiePayload</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;cookie&quot;</span><span class="p">,</span> <span class="nx">UUID</span><span class="o">:</span> <span class="s2">&quot;12345&quot;</span> <span class="p">};</span>
</code></pre></div>
<p>Once <em>both</em> tokens are received by the server, they are decoded and validated to make sure the payloads match.</p>

<p>The disadvantage is that this method relies on the client making all requests through AJAX.</p>
<h2><a class="anchor" name="module-electrode-csrf-jwt"></a>Module: <a href="https://github.com/electrode-io/electrode-csrf-jwt">electrode-csrf-jwt</a> <a class="hash-link" href="#module-electrode-csrf-jwt">#</a></h2><h3><a class="anchor" name="install-via-npm"></a>Install via <code>npm</code> <a class="hash-link" href="#install-via-npm">#</a></h3><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ npm install --save electrode-csrf-jwt
</code></pre></div><h3><a class="anchor" name="example-applications"></a>Example Applications <a class="hash-link" href="#example-applications">#</a></h3>
<ul>
<li><p><a href="https://github.com/electrode-io/electrode-boilerplate-universal-react-node#electrode-csrf-jwt">Electrode Boilerplate</a></p></li>
<li><p><a href="https://github.com/docs-code-examples-electrode-io/express-example-with-standalone-electrode-modules#electrode-csrf-jwt">Express Example with Standalone Modules</a></p></li>
<li><p><a href="https://github.com/docs-code-examples-electrode-io/hapijs-example-with-standalone-electrode-modules#electrode-csrf-jwt">Hapi Example with Standalone Modules</a></p></li>
</ul>
<h2><a class="anchor" name="usage"></a>Usage <a class="hash-link" href="#usage">#</a></h2><h3><a class="anchor" name="configuration"></a>Configuration <a class="hash-link" href="#configuration">#</a></h3>
<p>This module can be configured to work in any <a href="#electrode">Electrode</a>, <a href="#express">Express</a>, or <a href="#hapi">Hapi</a> application.</p>

<p>Whichever platform you are using, an <code>options</code> property with a secret key is required:</p>

<blockquote>
<p><strong>options</strong>
* <code>secret</code>: <strong>Required</strong>. A string or buffer containing either the secret for HMAC algorithms, or the PEM encoded private key for RSA and ECDSA.</p>
</blockquote>

<p>Other config properties are optional and follow the <a href="https://github.com/auth0/node-jsonwebtoken/blob/master/README.md#usage">same usage as jsonwebtoken</a></p>

<ul>
<li><code>algorithm</code></li>
<li><code>expiresIn</code></li>
<li><code>notBefore</code></li>
<li><code>audience</code></li>
<li><code>subject</code></li>
<li><code>issuer</code></li>
<li><code>jwtid</code></li>
<li><code>subject</code></li>
<li><code>noTimestamp</code></li>
<li><code>headers</code></li>
</ul>
<h3><a class="anchor" name="electrode"></a>Electrode <a class="hash-link" href="#electrode">#</a></h3>
<p>All server configurations in <a href="http://www.electrode.io/docs/what_is_electrode.html">Electrode apps</a> are handled by the versatile <a href="http://www.electrode.io/docs/confippet.html">confippet</a> module. The Stateless CSRF JWT Validation module can be easily configured by adding the following property to <code>config/default.json</code>:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;electrode-csrf-jwt&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;shhhhh&quot;</span><span class="p">,</span>
        <span class="nt">&quot;expiresIn&quot;</span><span class="p">:</span> <span class="mi">60</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3><a class="anchor" name="express"></a>Express <a class="hash-link" href="#express">#</a></h3><h4><a class="anchor" name="example-app.js-configuration"></a>Example <code>app.js</code> configuration <a class="hash-link" href="#example-app.js-configuration">#</a></h4><div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">csrfMiddleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;electrode-csrf-jwt&quot;</span><span class="p">).</span><span class="nx">expressMiddleware</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">secret</span><span class="o">:</span> <span class="s2">&quot;shhhhh&quot;</span><span class="p">,</span>
  <span class="nx">expiresIn</span><span class="o">:</span> <span class="mi">60</span>
<span class="p">};</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">csrfMiddleware</span><span class="p">(</span><span class="nx">options</span><span class="p">));</span>
</code></pre></div><h3><a class="anchor" name="hapi"></a>Hapi <a class="hash-link" href="#hapi">#</a></h3><h4><a class="anchor" name="example-serverindex.js-configuration"></a>Example <code>server/index.js</code> configuration <a class="hash-link" href="#example-serverindex.js-configuration">#</a></h4><div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">csrfPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;electrode-csrf-jwt&quot;</span><span class="p">).</span><span class="nx">register</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;hapi&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">secret</span><span class="o">:</span> <span class="s2">&quot;shhhhh&quot;</span><span class="p">,</span>
  <span class="nx">expiresIn</span><span class="o">:</span> <span class="mi">60</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span><span class="nx">register</span><span class="o">:</span> <span class="nx">csrfPlugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><h3><a class="anchor" name="usage-example"></a>Usage Example <a class="hash-link" href="#usage-example">#</a></h3>
<p>With the configuration shown above, your app is now ready to use Stateless CSRF JWT Validation. At this point, server endpoints do not require any additional configuration for protection to be enabled. Your <code>GET</code> endpoints will automatically return a CSRF cookie <em>and</em> header, and your <code>POST</code> endpoints will require the same.</p>

<p>Let&#39;s see a simple <a href="https://github.com/electrode-io/electrode/blob/d4142ee0c938cbf973a429ee8467052aa4e1c9be/samples/universal-react-node/README.md#electrode-csrf-jwt">example</a> to show how the CSRF tokens are automatically configured:</p>

<p><strong>Server Endpoint Setup</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/1&quot;</span><span class="p">,</span>
  <span class="nx">handler</span><span class="o">:</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">reply</span><span class="p">(</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/2&quot;</span><span class="p">,</span>
  <span class="nx">handler</span><span class="o">:</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">reply</span><span class="p">(</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div>
<p>Here we set up two simple endpoints:</p>

<ul>
<li>a <code>GET</code> endpoint, <code>/1</code>, to which the module automatically adds a csrf token header</li>
<li>a <code>POST</code> endpoint, <code>/2</code>, to which the module ensures the presence of a valid token in the request headers</li>
</ul>

<p>Let&#39;s see how to access them from the client:</p>

<p><strong>Client AJAX Setup</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="c1">//A simple post Fn that now requires a csrf token to be passed in the header</span>

<span class="kd">function</span> <span class="nx">doPost</span><span class="p">(</span><span class="nx">csrfToken</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/2&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">credentials</span><span class="o">:</span> <span class="s2">&quot;same-origin&quot;</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;Accept&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
      <span class="s2">&quot;x-csrf-jwt&quot;</span><span class="o">:</span> <span class="nx">csrfToken</span>
    <span class="p">},</span>
    <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">})</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">resp</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">doGet</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/1&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">credentials</span><span class="o">:</span> <span class="s2">&quot;same-origin&quot;</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">resp</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s2">&quot;200&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;x-csrf-jwt&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">token</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Got CSRF token OK&quot;</span><span class="p">);</span>
        <span class="nx">doPost</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>In this example a <code>POST</code> request to <code>/2</code> can be made using the token retrieved from the <code>/1</code> endpoint.</p>

<p>You can checkout our <a href="https://github.com/electrode-io/electrode#boilerplate-universal-react-node">Electrode Boilerplate React Application</a> for a more detailed example</p>


    








<div class="docs-prevnext">
  
    <a class="docs-prev" href="/docs/server_side_render_cache.html">&larr; Prev</a>
  
  
    <a class="docs-next" href="/docs/redux_router_engine.html">Next &rarr;</a>
  
</div>


  </div>
</section>


    <footer class="wrap">
      <div class="left">
        <a href="https://github.com/orgs/electrode-io/people" target="_blank">Acknowledgements</a>
      </div>
      <div class="right">
        &copy; 2020 <a href="http://walmartlabs.com" target="_blank">WalmartLabs</a><br>
        Apache-2.0 license.
      </div>
    </footer>
  </div>
  <div id="fb-root"></div>

  <!--
    TODO: analytics js, etc.
  -->
</body>
</html>
